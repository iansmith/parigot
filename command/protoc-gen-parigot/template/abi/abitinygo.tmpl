//+build parigot_abi

// This file has been machine generated from proto/abi.proto.  DO NOT EDIT OR YOU WILL LOSE.

// Note that the notation:
// func foo()
// with no body indicates that tinygo should consider that function implemented
// elsewhere, as the typical go compiler does.  For tinygo, we implement the
// calls in the container, the typical go compiler expects the "missing" functions
// to be implemented in assembly. Both of the compilers are effectively delaying
// resolution of the function call target until link time.

package abi
import(
    _ "unsafe"
)

// The ABI is a set of functions where control is passed from "user code" to "kernel code"
// in parigot.  In other words, the running container with normal code in it drops
// through this interface to reach container-implemented code.  Like kernel code in
// linux or similar, the implementation of that kernel code is not visible to the
// user program.


//
// These functions are for access to the ABI from golang. Additionally, these
// implementations induce tinygo to call the inner function with the "real"
// wasm parameters.
//

{{- range .info.Service }}
{{- range .GetWasmMethod}}
{{- $methodRet:=call .FuncChoice.MethodRet .InputCodeNeeded .OutputCodeNeeded .PullParameters .PullOutput true . }}
{{- $retValue:=call .FuncChoice.RetValue .InputCodeNeeded .OutputCodeNeeded .PullParameters .PullOutput  . }}
{{- $methParamDecl:=call .FuncChoice.MethodParamDecl .InputCodeNeeded .OutputCodeNeeded .PullParameters .PullOutput .}}
{{- $methCall:=call .FuncChoice.MethodCall .InputCodeNeeded .OutputCodeNeeded .PullParameters .PullOutput .}}
{{- $needsRet:=call .FuncChoice.NeedsRet .InputCodeNeeded .OutputCodeNeeded .PullParameters .PullOutput }}

//xxxx
//go:wasm-module parigot_abi
// not clear we care about this: export {{toCamelCase .GetName}}
//go:noinline
//xxxx

func {{toCamelCase .GetName}}({{$methParamDecl}}) {{$methodRet}} {
{{- if $needsRet }}
    return {{.GetWasmMethodName}}_({{$methCall}})
{{- else}}
    {{.GetWasmMethodName}}_({{$methCall}})
{{- end}}
}

{{- end }} {{/*range over methods */}}
{{- end }} {{/*range over services*/}}

{{- range .info.Service }}
{{- range .GetWasmMethod}}
{{- $methodRet:=call .FuncChoice.MethodRet .InputCodeNeeded .OutputCodeNeeded .PullParameters .PullOutput true . }}
{{- $methParamDecl:=call .FuncChoice.MethodParamDecl .InputCodeNeeded .OutputCodeNeeded .PullParameters .PullOutput .}}

//go:noinline
//export {{.GetWasmMethodName}}_
//go:wasm-module parigot_abi
//go:linkname {{.GetWasmMethodName}}_
func {{.GetWasmMethodName}}_({{$methParamDecl}}) {{$methodRet}}

{{- end }} {{/*range over methods */}}
{{- end }} {{/*range over services*/}}

